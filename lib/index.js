"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=_interopDefault(require("react")),ClassNames=_interopDefault(require("classnames")),immutable=require("immutable"),PropTypes=_interopDefault(require("prop-types"));function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}var css='.t-input-box {\n  display: inline-block; }\n  .t-input-box .t-input-wrap {\n    width: 100%;\n    min-height: 30px;\n    line-height: 20px;\n    border-radius: 3px;\n    box-sizing: border-box;\n    transition: .3s ease-in-out;\n    border: 1px solid #a9a9a9;\n    padding: 5px;\n    display: inline-block; }\n  .t-input-box .t-input-wrap.error {\n      border-color: red; }\n  .t-input-box .t-input-wrap.focus:not(.error) {\n      box-shadow: 0 0 5px #41A9EF; }\n  .t-input-box .t-input-wrap.error.focus {\n      box-shadow: 0 0 5px red; }\n  .t-input-box .t-input-wrap:not(.error):hover {\n      border-color: #41A9EF; }\n  .t-input-box .t-input-wrap .text-overflow {\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      -o-text-overflow: ellipsis;\n      overflow: hidden; }\n  .t-input-box .t-input-wrap .t-input-tag {\n      display: inline-block;\n      position: relative;\n      margin-right: 5px;\n      max-width: 45%;\n      font-size: 13px;\n      padding: 0 20px 0 10px;\n      background: #f3f3f3;\n      border-radius: 4px;\n      color: #666;\n      transition: .4s;\n      vertical-align: middle; }\n  .t-input-box .t-input-wrap .t-input-tag .t-input-remove {\n        position: absolute;\n        cursor: pointer;\n        width: 10px;\n        right: 2px;\n        top: -1px; }\n  .t-input-box .t-input-wrap input[type="text"] {\n      outline: none;\n      border: none;\n      min-width: 50px; }\n  .t-input-box .errTip {\n    margin-left: 5px;\n    font-size: 13px;\n    vertical-align: bottom; }\n';styleInject(css);var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var TagsInput=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={tags:t.props.defaultTags||[],tagValue:"",inFocus:!1,width:"0.75em",error:t.vertifyTaginRule(t.props.defaultTags||[])},t.tagInput=null,t}return _inherits(n,React.Component),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){immutable.fromJS(this.props.tags).equals(e.tags)||this.setState({tags:e.tags||[],error:this.vertifyTaginRule(e.defaultTags||[])})}},{key:"inFocusBool",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.state.inFocus!==e&&this.setState({inFocus:e})}},{key:"vertifyTaginRule",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.tags;return!!this.props.rule&&e.some(function(e){return!t.props.rule.test(e)})}},{key:"handleBlurInput",value:function(){var e=this.state,t=e.tagValue,n=e.tags;t&&(n.push(t),this.props.onChange(n),this.setState({tagValue:"",error:this.vertifyTaginRule(n)})),this.inFocusBool(!1)}},{key:"handleRemoveTag",value:function(e){var t=this.state.tags,n=t.indexOf(e);t.splice(n,1),this.props.onChange(t),this.setState({tags:t,error:this.vertifyTaginRule(t)})}},{key:"handleKeyUpInput",value:function(e){13===e.keyCode?this.handleBlurInput():8===e.keyCode&&this.handleRemoveTag()}},{key:"handleChangeTag",value:function(e){this.setState({tagValue:e})}},{key:"focusToInput",value:function(){this.tagInput.focus()}},{key:"randomNumber",value:function(e,t){return Math.random()*(t-e)+e}},{key:"getRandomColor",value:function(){return"rgb("+this.randomNumber(10,170)+", "+this.randomNumber(10,170)+", "+this.randomNumber(10,170)+")"}},{key:"render",value:function(){var n=this,e=this.state,t=e.tags,r=e.inFocus,o=e.tagValue,i=e.error,a=(e.width,t.map(function(t,e){return React.createElement("div",{key:e,className:"t-input-tag text-overflow",title:t,style:{background:n.props.fullColor?n.getRandomColor():"#f3f3f3",color:n.props.fullColor?"#fff":"#666"}},React.createElement("span",{className:"t-input-inner"},t),React.createElement("span",{className:"t-input-remove",onClick:function(e){return n.handleRemoveTag(t)}},"x"))}));return React.createElement("div",{className:"t-input-box",style:{width:this.props.width||"100%"}},React.createElement("div",{className:ClassNames({focus:r,error:i,"t-input-wrap":!0}),onClick:this.focusToInput.bind(this)},a,React.createElement("input",{type:"text",style:{width:0===t.length?"100%":"20%"},placeholder:0===t.length?this.props.placeholder:"",value:o,ref:function(e){return n.tagInput=e},onFocus:function(e){return n.inFocusBool()},onBlur:function(e){return n.handleBlurInput()},onKeyUp:function(e){return n.handleKeyUpInput(e)},onChange:function(e){return n.handleChangeTag(e.target.value)}})),React.createElement("span",{className:"errTip",style:{display:this.state.error&&this.props.errTip?"inline-block":"none",color:"red"}},this.props.errTip))}}]),n}();TagsInput.propTypes={defaultTags:PropTypes.array,onChange:PropTypes.func.isRequired,placeholder:PropTypes.string,rule:PropTypes.object,errTip:PropTypes.string,fullColor:PropTypes.bool},module.exports=TagsInput;
